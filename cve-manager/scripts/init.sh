#!/bin/bash
source ./scripts/colors.sh

source ./scripts/banner.sh

echo -e "${Cyan}[INFO] Downloading and parsing CVE files from NIST NVD...\n${NC}"
./scripts/cve_manager.py -d -p -csv
echo -e "${Cyan}[INFO] Creating database..\n${NC}"
./scripts/cve_manager.py -u postgres -server pg-server -db vuln_db -cd
echo -e "${Cyan}[INFO] Creating tables and views..\n${NC}"
./scripts/cve_manager.py -u postgres -server pg-server -db vuln_db -ct
echo -e "${Cyan}[INFO] Populating database..\n${NC}"
./scripts/cve_manager.py -u postgres -server pg-server -db vuln_db -idb -p
echo -e "${Cyan}[INFO] Download and importing CWE database..\n${NC}"
echo -e "${Red}[WARNING] Remove old files? [y/n]\n${NC}"
rm -v -i ./nvd/2000.csv.zip && rm -v -i ./results/2000.csv
wget https://cwe.mitre.org/data/csv/2000.csv.zip -P ./nvd
unzip ./nvd/2000.csv.zip -d ./results/
./scripts/cve_manager.py -u postgres -server pg-server -db vuln_db -icwe 2000.csv

echo -e "${Yellow}Done!\n${NC}"

echo -e "${Purple}You can view imported data with pgAdmin4.
Open your browser${NC} http://localhost:8080${Purple} and use these credentials:${NC}"

echo -e "E-mail: ${Red}user@example.com${NC} Password: ${Red}password\n${NC}"
